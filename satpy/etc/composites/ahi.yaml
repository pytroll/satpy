sensor_name: visir/ahi

modifiers:
  rayleigh_corrected:
    compositor: !!python/name:satpy.composites.PSPRayleighReflectance
    atmosphere: us-standard
    aerosol_type: marine_clean_aerosol
    prerequisites:
    - wavelength: 0.65
      modifiers: [sunz_corrected]
    optional_prerequisites:
    - satellite_azimuth_angle
    - satellite_zenith_angle
    - solar_azimuth_angle
    - solar_zenith_angle

composites:
  green:
    compositor: !!python/name:satpy.composites.ahi.GreenCorrector
    # FUTURE: Set a wavelength...see what happens. Dependency finding
    #         probably wouldn't work.
    prerequisites:
    # should we be using the most corrected or least corrected inputs?
    # what happens if something requests more modifiers on top of this?
    - wavelength: 0.51
      modifiers: [sunz_corrected, rayleigh_corrected]
    - wavelength: 0.85
      modifiers: [sunz_corrected]
    standard_name: toa_bidirectional_reflectance

  airmass:
    # PDF slides: https://www.eumetsat.int/website/home/News/ConferencesandEvents/DAT_2833302.html
    # Under session 2 by Akihiro Shimizu (JMA)
    compositor: !!python/name:satpy.composites.GenericCompositor
    prerequisites:
      - compositor: !!python/name:satpy.composites.DifferenceCompositor
        prerequisites:
          - name: B08
          - name: B10
      - compositor: !!python/name:satpy.composites.DifferenceCompositor
        prerequisites:
          - name: B12
          - name: B14
      - name: B08
    standard_name: airmass

  ash:
    compositor: !!python/name:satpy.composites.GenericCompositor
    prerequisites:
      - compositor: !!python/name:satpy.composites.DifferenceCompositor
        prerequisites:
          - name: B15
          - name: B13
      - compositor: !!python/name:satpy.composites.DifferenceCompositor
        prerequisites:
          - name: B14
          - name: B11
      - name: B13
    standard_name: ash

  dust:
    compositor: !!python/name:satpy.composites.GenericCompositor
    prerequisites:
      - compositor: !!python/name:satpy.composites.DifferenceCompositor
        prerequisites:
          - name: B15
          - name: B13
      - compositor: !!python/name:satpy.composites.DifferenceCompositor
        prerequisites:
          - name: B14
          - name: B11
      - name: B13
    standard_name: dust

  fog:
    compositor: !!python/name:satpy.composites.GenericCompositor
    prerequisites:
      - compositor: !!python/name:satpy.composites.DifferenceCompositor
        prerequisites:
          - name: B15
          - name: B13
      - compositor: !!python/name:satpy.composites.DifferenceCompositor
        prerequisites:
          - name: B14
          - name: B11
      - name: B13
    standard_name: fog

  night_microphysics:
    compositor: !!python/name:satpy.composites.GenericCompositor
    prerequisites:
      - compositor: !!python/name:satpy.composites.DifferenceCompositor
        prerequisites:
          - name: B15
          - name: B13
      - compositor: !!python/name:satpy.composites.DifferenceCompositor
        prerequisites:
          - name: B14
          - name: B07
      - name: B13
    standard_name: night_microphysics

  fire_temperature:
    # CIRA: Original VIIRS
    compositor: !!python/name:satpy.composites.GenericCompositor
    prerequisites:
    - wavelength: 3.85
      calibration: radiance
    - wavelength: 2.26
      calibration: radiance
    - wavelength: 1.61
      calibration: radiance
    standard_name: fire_temperature
    name: fire_temperature
  fire_temperature_awips:
    # CIRA: EUMETSAT
    compositor: !!python/name:satpy.composites.GenericCompositor
    prerequisites:
    - wavelength: 3.85
    - wavelength: 2.26
    - wavelength: 1.61
    standard_name: fire_temperature
    name: fire_temperature_awips

  fire_temperature_eumetsat:
    # CIRA: AWIPS
    compositor: !!python/name:satpy.composites.GenericCompositor
    prerequisites:
    - wavelength: 3.85
    - wavelength: 2.26
    - wavelength: 1.61
    standard_name: fire_temperature
    name: fire_temperature_eumetsat
  fire_temperature_39refl:
    # CIRA: All bands in Reflectance units (%)
    compositor: !!python/name:satpy.composites.GenericCompositor
    prerequisites:
    - wavelength: 3.85
      modifiers: [nir_reflectance]
    - wavelength: 2.26
      modifiers: [sunz_corrected]
    - wavelength: 1.61
      modifiers: [sunz_corrected]
    standard_name: fire_temperature
    name: fire_temperature_39refl


  overview:
    compositor: !!python/name:satpy.composites.GenericCompositor
    prerequisites:
    - 0.65
    - 0.85
    - 10.4
    standard_name: overview

  natural_color:
    compositor: !!python/name:satpy.composites.SelfSharpenedRGB
    prerequisites:
    - wavelength: 1.63
      modifiers: [sunz_corrected] #, rayleigh_corrected]
    - wavelength: 0.85
      modifiers: [sunz_corrected] #, rayleigh_corrected]
    - wavelength: 0.635
      modifiers: [sunz_corrected] #, rayleigh_corrected]
    high_resolution_band: blue
    standard_name: natural_color

  true_color:
    compositor: !!python/name:satpy.composites.SelfSharpenedRGB
    prerequisites:
    - wavelength: 0.65
      modifiers: [sunz_corrected, rayleigh_corrected]
    - name: green
    - wavelength: 0.46
      modifiers: [sunz_corrected, rayleigh_corrected]
    high_resolution_band: red
    standard_name: true_color

#  true_color_reducedsize_land:
#    compositor: !!python/name:satpy.composites.GenericCompositor
#    prerequisites:
#    - wavelength: 0.65
#      modifiers: [reducer4, effective_solar_pathlength_corrected,
#                  rayleigh_corrected_reducedsize_land]
#    - wavelength: 0.51
#      modifiers: [reducer2, vegetation_corrected_reduced, effective_solar_pathlength_corrected,
#                  rayleigh_corrected_reducedsize_land]
#    - wavelength: 0.46
#      modifiers: [reducer2, effective_solar_pathlength_corrected,
#                  rayleigh_corrected_reducedsize_land]
#    standard_name: true_color
#
#  true_color_reducedsize_marine_tropical:
#    compositor: !!python/name:satpy.composites.GenericCompositor
#    prerequisites:
#    - wavelength: 0.65
#      modifiers: [reducer4, effective_solar_pathlength_corrected,
#                  rayleigh_corrected_reducedsize_marine_tropical]
#    - wavelength: 0.51
#      modifiers: [reducer2, vegetation_corrected_reduced, effective_solar_pathlength_corrected,
#                  rayleigh_corrected_reducedsize_marine_tropical]
#    - wavelength: 0.46
#      modifiers: [reducer2, effective_solar_pathlength_corrected,
#                  rayleigh_corrected_reducedsize_marine_tropical]
#    standard_name: true_color

  day_microphysics_eum:
    compositor: !!python/name:satpy.composites.GenericCompositor
    prerequisites:
    - wavelength: 0.86
    - wavelength: 3.9
      modifiers: [nir_reflectance]
    - wavelength: 10.4
    standard_name: day_microphysics

  day_microphysics_ahi:
    compositor: !!python/name:satpy.composites.GenericCompositor
    prerequisites:
    - wavelength: 0.86
    - wavelength: 2.3
    - wavelength: 10.4
    standard_name: day_microphysics

  cloud_phase_distinction:
    compositor: !!python/name:satpy.composites.GenericCompositor
    prerequisites:
    - wavelength: 10.4
    - wavelength: 0.64
    - wavelength: 1.6
    standard_name: cloud_phase_distinction

  water_vapors1:
    compositor: !!python/name:satpy.composites.GenericCompositor
    prerequisites:
    - wavelength: 10.4
    - wavelength: 6.2
    - wavelength: 7.3
    standard_name: water_vapors1

  mid_vapor:
    compositor: !!python/name:satpy.composites.DifferenceCompositor
    prerequisites:
    - wavelength: 7.3
    - wavelength: 6.2
    standard_name: mid_vapor

  water_vapors2:
    compositor: !!python/name:satpy.composites.GenericCompositor
    prerequisites:
    - name: mid_vapor
    - wavelength: 7.3
    - wavelength: 6.2
    standard_name: water_vapors2

  convection:
    compositor: !!python/name:satpy.composites.GenericCompositor
    prerequisites:
    - compositor: !!python/name:satpy.composites.DifferenceCompositor
      prerequisites:
        - 6.7
        - 7.3
    - compositor: !!python/name:satpy.composites.DifferenceCompositor
      prerequisites:
        - 3.75
        - 10.4
    - compositor: !!python/name:satpy.composites.DifferenceCompositor
      prerequisites:
        - 1.63
        - 0.635
    standard_name: convection

  ir_cloud_day:
    standard_name: ir_cloud_day
    compositor: !!python/name:satpy.composites.CloudCompositor
    prerequisites:
      - name: B14

  cloudmask:
    compositor: !!python/name:satpy.composites.PaletteCompositor
    prerequisites:
    - cma
    - cma_pal
    standard_name: cloudmask

  cloudtype:
    compositor: !!python/name:satpy.composites.PaletteCompositor
    prerequisites:
    - ct
    - ct_pal
    standard_name: cloudtype

  cloud_top_height:
    compositor: !!python/name:satpy.composites.PaletteCompositor
    prerequisites:
    - ctth_alti
    - ctth_alti_pal
    standard_name: cloud_top_height

  cloud_top_pressure:
    compositor: !!python/name:satpy.composites.PaletteCompositor
    prerequisites:
    - ctth_pres
    - ctth_pres_pal
    standard_name: cloud_top_pressure

  cloud_top_temperature:
    compositor: !!python/name:satpy.composites.PaletteCompositor
    prerequisites:
    - ctth_tempe
    - ctth_tempe_pal
    standard_name: cloud_top_temperature

  cloud_top_phase:
    compositor: !!python/name:satpy.composites.PaletteCompositor
    prerequisites:
    - cmic_phase
    - cmic_phase_pal
    standard_name: cloud_top_phase

  cloud_drop_effective_radius:
    compositor: !!python/name:satpy.composites.PaletteCompositor
    prerequisites:
    - cmic_reff
    - cmic_reff_pal
    standard_name: cloud_drop_effective_radius

  cloud_optical_thickness:
    compositor: !!python/name:satpy.composites.PaletteCompositor
    prerequisites:
    - cmic_cot
    - cmic_cot_pal
    standard_name: cloud_optical_thickness

  cloud_liquid_water_path:
    compositor: !!python/name:satpy.composites.PaletteCompositor
    prerequisites:
    - cmic_lwp
    - cmic_lwp_pal
    standard_name: cloud_liquid_water_path

  cloud_ice_water_path:
    compositor: !!python/name:satpy.composites.PaletteCompositor
    prerequisites:
    - cmic_iwp
    - cmic_iwp_pal
    standard_name: cloud_ice_water_path

  precipitation_probability:
    compositor: !!python/name:satpy.composites.PaletteCompositor
    prerequisites:
    - pc
    - pc_pal
    standard_name: precipitation_probability

  convective_rain_rate:
    compositor: !!python/name:satpy.composites.PaletteCompositor
    prerequisites:
    - crr
    - crr_pal
    standard_name: convective_rain_rate

  convective_precipitation_hourly_accumulation:
    compositor: !!python/name:satpy.composites.PaletteCompositor
    prerequisites:
    - crr_accum
    - crr_pal
    standard_name: convective_precipitation_hourly_accumulation

  total_precipitable_water:
    compositor: !!python/name:satpy.composites.PaletteCompositor
    prerequisites:
    - ishai_tpw
    - ishai_tpw_pal
    standard_name: total_precipitable_water

  showalter_index:
    compositor: !!python/name:satpy.composites.PaletteCompositor
    prerequisites:
    - ishai_shw
    - ishai_shw_pal
    standard_name: showalter_index

  lifted_index:
    compositor: !!python/name:satpy.composites.PaletteCompositor
    prerequisites:
    - ishai_li
    - ishai_li_pal
    standard_name: lifted_index

  convection_initiation_prob30:
    compositor: !!python/name:satpy.composites.PaletteCompositor
    prerequisites:
    - ci_prob30
    - ci_pal
    standard_name: convection_initiation_prob30

  convection_initiation_prob60:
    compositor: !!python/name:satpy.composites.PaletteCompositor
    prerequisites:
    - ci_prob60
    - ci_pal
    standard_name: convection_initiation_prob60

  convection_initiation_prob90:
    compositor: !!python/name:satpy.composites.PaletteCompositor
    prerequisites:
    - ci_prob90
    - ci_pal
    standard_name: convection_initiation_prob90

  asii_prob:
    compositor: !!python/name:satpy.composites.PaletteCompositor
    prerequisites:
    - asii_turb_trop_prob
    - asii_turb_prob_pal
    standard_name: asii_prob

  rdt_cell_type:
    compositor: !!python/name:satpy.composites.PaletteCompositor
    prerequisites:
    - MapCellCatType
    - MapCellCatType_pal
    standard_name: rdt_cell_type
